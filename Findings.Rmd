---
title: "Programmes and Events Pilot Analysis"
author: "Lee Durbin"
date: "`r format(Sys.time(), '%d %B, %Y')`"

output:
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 3
theme: lumen
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("ggplot2")
library("ggthemes")
library("DT")

source("analysis.R")
```

```{r functions, include=FALSE}

```


## Inside a library vs outside a library

How many sessions were delivered inside a library vs outside a library?

```{r loction_is_lib, echo = FALSE}
df %>% 
  filter(!is.na(location_is_library)) %>% 
    mutate(across(where(is.character) & !what_was_the_name_of_the_session, as.factor)) %>% 
  select(id, "Session Name" = what_was_the_name_of_the_session, "Location" = where_was_the_session_delivered, "Locatioon Group" = location_is_library) %>% 
  DT::datatable(
    caption = 'Sessions inside a community library vs outside a community library',
    filter = "top",
    rownames = FALSE,
    options = list(
      autoWidth = TRUE
    )
  )

data <- df %>% 
  filter(!is.na(location_is_library)) %>% 
  count(location_is_library)
  
g <- ggplot(data, mapping = aes(x = reorder(location_is_library, -n), y = n)) +
  geom_col() +
  theme_fivethirtyeight()

g + geom_text(aes(label=n), position=position_dodge(width=0.9), vjust=1.5, color = "white") +
  labs(x = "", y = "Number of sessions")
```

## Delivery group

How many sessions were co-delivered, how many were delivered by a library, and how many were delivered by an external?

```{r delivery_group, echo=FALSE}
df %>% 
  mutate(across(where(is.character) & !what_was_the_name_of_the_session, as.factor)) %>% 
  select(id, "Session Name" = what_was_the_name_of_the_session, "Delivery agent" = who_delivered_the_session, "Co-delivery agents" = with_whom_was_the_session_co_delivered, "Delivery Group" = delivery_group) %>% 
  DT::datatable(
    caption = 'Sessions by delivery group',
    filter = "top",
    rownames = FALSE,
    options = list(
      autoWidth = TRUE
    )
  )

data <- df %>% 
  count(delivery_group)

g <- ggplot(data, mapping = aes(x = reorder(delivery_group, -n), y = n)) +
  geom_col() +
  theme_fivethirtyeight()

g + geom_text(aes(label=n), position=position_dodge(width=0.9), vjust=1.5, color = "white") +
  labs(x = "", y = "Number of sessions")

```

## Delivery agent

Of the sessions that were *not* co-delivered, how many were delivered by each delivery agent?

```{r delivery_entities, echo=FALSE}
data <- df %>% 
  filter(was_the_session_co_delivered_with_other_library_teams_or_other_partners == "No") %>% 
  count(who_delivered_the_session)

g <- data %>% ggplot(mapping = aes(x = reorder(who_delivered_the_session, n), y = n)) +
  geom_col() +
  theme_fivethirtyeight()

g + geom_text(aes(label=n), hjust=1.25, colour = "white") +
  coord_flip() +
  labs(x = "", y = "Number of sessions")
```

## Co-delivery agent

Of the sessions that *were* co-delivered, how many were delivered by each delivery agent?

```{r co-delivery_entities, echo=FALSE}
data <- df %>% 
  filter(was_the_session_co_delivered_with_other_library_teams_or_other_partners == "Yes") %>% 
  count(with_whom_was_the_session_co_delivered)

g <- data %>% ggplot(mapping = aes(x = reorder(with_whom_was_the_session_co_delivered, n), y = n)) +
  geom_col() +
  theme_fivethirtyeight()

g + geom_text(aes(label=n), hjust=1.25, colour = "white") +
  labs(y = "", x = "Number of sessions") +
  coord_flip()
  
```

## Target audiences: Māori or Pasifika

Was the session designed to specifically benefit Māori or Pasifika?

```{r ethnic_groups, echo=FALSE}
data <- df %>% 
  count(was_the_session_designed_to_specifically_benefit_maori_or_pasifika)

g <- data %>% ggplot(mapping = aes(x = reorder(was_the_session_designed_to_specifically_benefit_maori_or_pasifika, n), y = n)) +
  geom_col() +
  theme_fivethirtyeight()

g + geom_text(aes(label=n), hjust=1.25, colour = "white") +
  labs(y = "", x = "Number of sessions") +
  coord_flip()
  
```

```{r maori_pasifika, echo=FALSE}
data <- df %>% 
  filter(was_the_session_designed_to_specifically_benefit_maori_or_pasifika == "Yes") %>% 
  count(which_community_was_the_session_designed_to_specifically_benefit)

g <- data %>% ggplot(mapping = aes(x = reorder(which_community_was_the_session_designed_to_specifically_benefit, n), y = n)) +
  geom_col() +
  theme_fivethirtyeight()

g + geom_text(aes(label=n), hjust=1.25, colour = "white") +
  labs(y = "", x = "Number of sessions") +
  coord_flip()
  
```
